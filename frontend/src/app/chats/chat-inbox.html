<!-- src/app/chat/chat-inbox.component.html -->
<!-- Dock tab (collapsed) -->
<div class="chat-dock-tab" [class.open]="dockOpen" (click)="toggleDock()" title="Inbox">
  <div class="avatar">A</div>
@if (unreadCount > 0) {
  <div class="badge">
    {{ unreadCount }}
  </div>
}


</div>

<!-- Mini Inbox Panel -->
<aside class="chat-panel" [class.open]="dockOpen" role="region" aria-label="Chat Inbox">
  <header class="panel-header">
    <div class="title">Inbox</div>
    <div class="actions">
      <button class="btn ghost" (click)="toggleDock()">Cerrar</button>
      <button class="btn" (click)="toggleFullScreen()">Pantalla</button>
    </div>
  </header>

  <div class="panel-body">
    <div class="search">
      <input placeholder="Buscar conversaciones..." />
    </div>

    <div class="conversations-list">
      <div *ngFor="let c of conversations" class="conv-item" (click)="openConversation(c)" [class.unread]="c.unread>0">
        <div class="left">
          <div class="channel-icon" [ngClass]="c.channel"></div>
        </div>
        <div class="center">
          <div class="name-row">
            <div class="name">{{ c.contactName }}</div>
            <div class="time">{{ c.lastAt | date:'shortTime' }}</div>
          </div>
          <div class="last">{{ c.lastMessage }}</div>
        </div>
        <div class="right">
          <div class="badge" *ngIf="c.unread">{{ c.unread }}</div>
          <button class="mini" (click)="togglePin(c); $event.stopPropagation()">
            {{ c.pinned ? 'ðŸ“Œ' : 'â€”' }}
          </button>
        </div>
      </div>
    </div>

    <div class="quick-actions">
      <button class="btn" (click)="openConversation(conversations[0])">Simular abrir conversaciÃ³n</button>
      <button class="btn ghost" (click)="openReservationFromChat()">Crear reserva rÃ¡pida</button>
    </div>
  </div>
</aside>

<!-- Slide-over conversation -->
<div class="slide-over" *ngIf="slideOpen" [class.fullscreen]="fullScreen">
  <div class="slide-header">
    <div class="info">
      <div class="name">{{ selectedConv?.contactName }}</div>
      <div class="meta">{{ selectedConv?.phone }} Â· {{ selectedConv?.channel }}</div>
    </div>
    <div class="controls">
      <button class="btn ghost" (click)="openReservationFromChat()">Crear Reserva</button>
      <button class="btn ghost" (click)="toggleFullScreen()">{{ fullScreen ? 'Salir' : 'Full' }}</button>
      <button class="btn" (click)="closeSlide()">Cerrar</button>
    </div>
  </div>

  <div class="messages" id="messagesList">
    <div *ngIf="messages$ | async as msgs">
      <div *ngFor="let m of msgs" class="msg" [class.out]="m.direction === 'out'">
        <div class="bubble">
          <div class="text">{{ m.text }}</div>
          <div class="meta">{{ m.createdAt | date:'shortTime' }} <span *ngIf="m.direction==='out'">Â· {{ m.status
              }}</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="composer">
    <div class="templates">
      <select (change)="useTemplate($any($event.target).value)">
        <option value="">â€” Plantillas rÃ¡pidas â€”</option>
        <option *ngFor="let t of quickTemplates" [value]="t.text">{{ t.name }}</option>
      </select>
    </div>
    <textarea [(ngModel)]="composerText" placeholder="Escribe un mensaje..."></textarea>
    <div class="composer-actions">
      <button class="btn ghost" (click)="openReservationFromChat()">Crear Reserva</button>
      <button class="btn" (click)="sendMessage()">Enviar</button>
    </div>
  </div>
</div>

<!-- Reservation Modal (simple) -->
<div class="modal" *ngIf="showReservationForm">
  <div class="modal-content">
    <h3>Crear Reserva rÃ¡pida</h3>
    <label>Tour
      <select [(ngModel)]="reservationForm.tour">
        <option>GuatapÃ© - MaÃ±ana</option>
        <option>City Tour</option>
        <option>Santa Fe ExcursiÃ³n</option>
      </select>
    </label>
    <label>Fecha
      <input type="date" [(ngModel)]="reservationForm.date" />
    </label>
    <label>Pasajeros
      <input type="number" min="1" [(ngModel)]="reservationForm.passengers" />
    </label>
    <label>Contacto
      <input type="text" [(ngModel)]="reservationForm.contactName" />
    </label>
    <label>TelÃ©fono
      <input type="text" [(ngModel)]="reservationForm.phone" />
    </label>

    <div class="modal-actions">
      <button class="btn ghost" (click)="showReservationForm = false">Cancelar</button>
      <button class="btn" (click)="createReservation()">Crear y Enviar ConfirmaciÃ³n</button>
    </div>
  </div>
</div>