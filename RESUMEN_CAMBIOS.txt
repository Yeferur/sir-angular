â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SIR-ANGULAR: CAMBIOS PARA PRODUCCIÃ“N                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ ARCHIVOS MODIFICADOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. âœ… backend/websocket.js
   â””â”€ Puerto: 5000 â†’ 6000 (lÃ­nea 7)

2. âœ… backend/server.js
   â””â”€ Mensaje console: puerto 5000 â†’ 6000 (lÃ­nea 44)

3. âœ… backend/database/db.js
   â””â”€ Manejo flexible de .env para development/production

4. âœ… frontend/src/app/services/WebSocket/web-socket.ts
   â””â”€ URL dinÃ¡mica: ws://localhost:5000 â†’ ${wsProtocol}//${host}/ws


ğŸ“ ARCHIVOS NUEVOS CREADOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. ğŸ“‹ ecosystem.config.js
   â”œâ”€ ConfiguraciÃ³n PM2 para backend (puerto 4000)
   â”œâ”€ ConfiguraciÃ³n PM2 para frontend (puerto 3000)
   â””â”€ GestiÃ³n de logs y recursos

2. ğŸŒ nginx.conf
   â”œâ”€ Proxy reverso puerto 80/443
   â”œâ”€ Rutas:
   â”‚  â”œâ”€ / â†’ localhost:3000 (frontend)
   â”‚  â”œâ”€ /api â†’ localhost:4000 (backend)
   â”‚  â”œâ”€ /ws â†’ localhost:6000 (websocket)
   â”‚  â””â”€ /uploads â†’ localhost:4000
   â””â”€ ConfiguraciÃ³n HTTPS comentada (SSL)

3. ğŸ” backend/.env.production
   â”œâ”€ Variables de base de datos
   â”œâ”€ Variables JWT
   â””â”€ ConfiguraciÃ³n NODE_ENV=production

4. ğŸ“– DEPLOY_GUIDE.md
   â”œâ”€ GuÃ­a paso a paso de instalaciÃ³n
   â”œâ”€ ConfiguraciÃ³n de VPS
   â”œâ”€ Comandos PM2 y Nginx
   â””â”€ Troubleshooting

5. ğŸ“ CAMBIOS_PRODUCCION.md
   â”œâ”€ Resumen de cambios
   â”œâ”€ Checklist pre-producciÃ³n
   â””â”€ Archivos importantes

6. ğŸš€ deploy.sh
   â”œâ”€ Script automÃ¡tico de despliegue
   â”œâ”€ Instala dependencias
   â”œâ”€ Construye frontend
   â””â”€ Inicia con PM2

7. ğŸ–¥ï¸  test-local.bat (Windows)
   â””â”€ Script para probar localmente antes de subir


ğŸ”„ FLUJO DE CONEXIÃ“N EN PRODUCCIÃ“N:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CLIENTE (navegador)
    â†“
Nginx (puerto 80/443)
    â”œâ”€â†’ GET / (frontend en puerto 3000)
    â”œâ”€â†’ GET /api/* (backend en puerto 4000)
    â””â”€â†’ WebSocket /ws (backend en puerto 6000)


ğŸ“Š PUERTOS ANTES vs DESPUÃ‰S:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ANTES (localhost - desarrollo):
  Frontend:  localhost:4200
  Backend:   localhost:4000
  WebSocket: localhost:5000 âŒ (CONFLICTO EN VPS)

DESPUÃ‰S (VPS con Nginx):
  Frontend:  ejemplo.com (puerto 80/443)
  Backend:   ejemplo.com/api (proxy a puerto 4000)
  WebSocket: ejemplo.com/ws (proxy a puerto 6000) âœ…


ğŸ› ï¸  PASOS RÃPIDOS DE DESPLIEGUE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Copiar proyecto a VPS
   scp -r . ubuntu@tu_vps:/home/ubuntu/sir-angular/

2. SSH a VPS
   ssh ubuntu@tu_vps

3. Ejecutar deploy automÃ¡tico
   cd /home/ubuntu/sir-angular
   chmod +x deploy.sh
   ./deploy.sh

4. Configurar Nginx
   sudo cp nginx.conf /etc/nginx/sites-available/sir-angular
   sudo nano /etc/nginx/sites-available/sir-angular  # Editar dominio
   sudo ln -s /etc/nginx/sites-available/sir-angular /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx

5. Â¡Listo! Tu app estÃ¡ en producciÃ³n


âš ï¸  CAMBIOS CRÃTICOS DE CÃ“DIGO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ”´ ANTES:
   const wsUrl = 'ws://localhost:5000';  // âŒ Hardcoded a localhost

ğŸŸ¢ DESPUÃ‰S:
   const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
   const wsUrl = `${wsProtocol}//${window.location.host}/ws`;  // âœ… DinÃ¡mico


âœ… VENTAJAS DE ESTA CONFIGURACIÃ“N:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ“ Funciona en cualquier dominio (automÃ¡tico)
âœ“ Soporta HTTP y HTTPS sin cambios
âœ“ WebSocket no conflictÃºa con otros servicios
âœ“ Nginx maneja todo el trÃ¡fico (seguridad)
âœ“ PM2 auto-reinicia procesos si fallan
âœ“ Variables de entorno separadas por ambiente
âœ“ Logs centralizados
âœ“ FÃ¡cil de escalar


ğŸ” SEGURIDAD - CAMBIAR ANTES DE PRODUCCIÃ“N:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸  backend/.env (CRÃTICO):
    JWT_SECRET=tu_jwt_secret_bien_seguro_aqui
    DB_PASS=tu_contraseÃ±a_segura_aqui

âš ï¸  nginx.conf:
    server_name tu_dominio.com www.tu_dominio.com;

âš ï¸  ecosystem.config.js:
    cwd: '/home/ubuntu/sir-angular/...' (verificar rutas)


ğŸ“ VERIFICACIÃ“N POST-DESPLIEGUE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Ver procesos activos
pm2 status

# Ver logs
pm2 logs sir-backend
pm2 logs sir-frontend

# Probar conectividad
curl http://tu_vps/
curl http://tu_vps/api/
curl http://tu_vps:6000/  # WebSocket


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           Â¡LISTO PARA PRODUCCIÃ“N!                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
